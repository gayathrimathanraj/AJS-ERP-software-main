{% extends './base.html' %}

{% load static %}
{% block content %}
<div class="wrapper">
<!-- Sidebar -->
{% include "./includes/sidebar.html" %}

<div class="main-panel">
<div class="main-header" style="background:content-box !important;">
<div class="main-header-logo">
<!-- navbar -->
{% include "./includes/navbar.html" %}
</div>

<!--main content-->

<div class="container">
<div class="row">
<div class="">
<h3 class="fw-bold ms-3 ps-3 pt-3 mb-4">Tax Master</h3>
<div class="page-header mt-1">
<div class="col-md-8 col-sm-8">
<ul class="breadcrumbs mb-3">
<li class="nav-home">
<a href="{%url 'ajserp:dashboard'%}">
<i class="icon-home"></i>
</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="#">Inventory</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="#">Tax Master</a>
</li>
</ul>
</div>

</p>
</div>
</div>
</div>

<div class="container-fluid">
<div class="col-md-12">
<div class="card">
<div class="">
<div class="card-body" style="padding: 1.25rem">

<div class="container mt-3">
<div class="card p-4">
<!-- Material name -->
{% comment %} <div class="col-md-3">
<input
type="text"
class="form-control"
placeholder="HSN Code..."
aria-label="Search"
/>
</div> {% endcomment %}
<form method="post">
{% csrf_token %}
<div class="row">
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="Taxmaster">HSN Code</label>
{% comment %} <input type="text" name="hsn_code" class="form-control" placeholder="HSN Code..." aria-label="Search" required/> {% endcomment %}
<input 
    type="text" 
    name="hsn_code" 
    class="form-control hsnSearch" 
    placeholder="Type HSN Code..." 
    autocomplete="off"
    required
/>
<div class="hsnSuggestions autocomplete-suggestions"></div>  <!-- ✅ REMOVE ID, KEEP CLASS -->
<small class="form-text text-muted">Start typing to see available HSN codes</small>
</div>
</div>
{% comment %} <div class="col-md-2">
<button type="submit" class="btn btn-primary w-50">
Add
</button>
</div> {% endcomment %}

<!-- CGST -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="Taxmaster">CGST</label>
<input
    type="number"
    name="cgst"
    class="form-control"
    placeholder="CGST %"
    step="0.01"
    min="0"
    max="100"
    required
/>
</div>
</div>

<!-- SGST -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="Taxmaster">SGST</label>
<input
    type="number"
    name="sgst"
    class="form-control"
    placeholder="SGST %"
    step="0.01"
    min="0"
    max="100"
    required
/>
</div>
</div>

<!-- IGST -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="Taxmaster">IGST</label>
<input
    type="number"
    name="igst"
    class="form-control"
    placeholder="IGST %"
    step="0.01"
    min="0"
    max="100"
    required
/>
</div>
</div>

<!-- CESS -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="Taxmaster">CESS</label>
<input
    type="number"
    name="cess"
    class="form-control"
    placeholder="CESS %"
    step="0.01"
    min="0"
    max="100"
    required
/>
</div>
</div>

<!-- Add Button -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="Taxmaster" style="visibility: hidden;">Action</label>
<div class="d-flex align-items-end" style="height: 38px;">
<button type="submit" class="btn btn-primary">
    Add
</button>
</div>
</div>
</div>
</div>
</form> <!-- ADD THIS CLOSING FORM TAG -->
</div>
</div>
</div>


<!-- =================================items table start======================== -->

<div class="container-fluid">
<div class="col-md-12">
<div class="card-body" style="padding: 1.25rem">


<div class="row">
<div class="col-md-12">
<div class="card">
<div class="container">

<div class="card-body">
{% comment %} <div class="d-flex gap-2">

<div class="col-md-2 d-flex align-items-end mb-4">
<input type="text" class="form-control" placeholder="HSN Code">
</div>  



<!-- Common Search -->

<div class="col-md-2 d-flex align-items-end mb-4">
<input type="text" class="form-control" placeholder="Search">
</div>

</div> {% endcomment %}
</div>


<div class="table-responsive">
<table
id="basic-datatables"
class="display table table-bordered table-sm table-striped  align-middle table-hover text-center"
>
<thead style="padding: 13px 9px !important;">
<tr>
<th style="padding: 13px 9px !important;"><input type="checkbox"></th>
<th style="padding: 13px 9px !important;">HSN Code</th>
<th style="padding: 13px 9px !important;">CGST</th>
<th style="padding: 13px 9px !important;">SGST</th>
<th style="padding: 10px 9px !important;">IGST</th>
<th style="padding: 13px 9px !important;">CESS</th>
<th style="padding: 13px 9px !important;">Action</th>
</tr>
</thead>

<tbody>
<tr>
{% comment %} <td style="padding: 0px !important;"><input type="checkbox"></td>
<td>54673</td>
<td>500 Kgs</td>
<td>Rs 200</td>
<td>Rs 200</td>
<td>Rs 200</td>
<td>
<div class="form-button-action">

<button
type="button"
data-bs-toggle="tooltip"
title=""
class="btn btn-link btn-primary btn-lg"
data-original-title="Edit Task"
>
<i class="fa fa-edit"></i>
</button>
<button
type="button"
data-bs-toggle="modal"
data-bs-target="#myModaldelete"
title=""
class="btn btn-link btn-danger"
data-original-title="Remove"
>
<i class="fa fa-times"></i>
</button> {% endcomment %}
<tbody>
{% for tax in taxes %}
<tr>
<td style="padding: 0px !important;"><input type="checkbox"></td>
<td>{{ tax.hsn_code }}</td>
<td>{{ tax.cgst }}%</td>
<td>{{ tax.sgst }}%</td>
<td>{{ tax.igst }}%</td>
<td>{{ tax.cess }}%</td>
<td>
<div class="form-button-action">
<!-- Edit Button -->
<button
type="button"
data-bs-toggle="modal"
data-bs-target="#editTaxModal{{ tax.id }}"
class="btn btn-link btn-primary btn-lg">
<i class="fa fa-edit"></i>
</button>
{% comment %} <button type="button" class="btn btn-link btn-primary btn-lg">
<i class="fa fa-edit"></i>
</button>
<button type="button" class="btn btn-link btn-danger">
<i class="fa fa-times"></i>
</button> {% endcomment %}

<!-- Delete Button -->
<button
type="button"
data-bs-toggle="modal"
data-bs-target="#deleteModal{{ tax.id }}"
class="btn btn-link btn-danger">
<i class="fa fa-times"></i>
</button>
</div>
</td>
</tr>
{% empty %}
<tr>
<td colspan="7" class="text-center">No tax rates found. Add your first tax rate above.</td>
</tr>
{% endfor %}
</tbody>

<!-- The Modal -->
<div class="modal fade" id="myModaldelete">
<div class="modal-dialog">
<div class="modal-content">

<!-- Modal Header -->
<div class="modal-header">
<h4 class="modal-title"></h4>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>

<!-- Modal body -->
<div class="modal-body">
<div class="container" style="text-align: center;">
<h2>Delete Confirmation</h2><br>
<p>Are you sure you want to delete this Tax Master account?</p></div>
</div>

<!-- Modal footer -->
<div class="modal-footer"style="display:inline; text-align:center;">
<button type="button" class="btn btn-success" data-bs-dismiss="modal">Yes</button>
<button type="button" class="btn btn-danger" data-bs-dismiss="modal">No</button>
</div>

</div>
</div>
</div>
</div>
</td>
</tr>

{% comment %} <tr>
<td><input type="checkbox"></td>
<td>54673</td>
<td>400 Kgs</td>
<td>Rs 900</td>
<td>400 Kgs</td>
<td>400 Kgs</td>
<td>
<div class="form-button-action">

<button
type="button"
data-bs-toggle="tooltip"
title=""
class="btn btn-link btn-primary btn-lg"
data-original-title="Edit Task"
>
<i class="fa fa-edit"></i>
</button>
<button
type="button"
data-bs-toggle="tooltip"
title=""
class="btn btn-link btn-danger"
data-original-title="Remove"
>
<i class="fa fa-times"></i>
</button>
</div>
</td>
</tr> {% endcomment %}
</div>
</tbody>
</table>
<nav aria-label="Page navigation example">
<ul class="pagination justify-content-end">
<li class="page-item disabled">
<a class="page-link">Previous</a>
</li>
<li class="page-item">
<a class="page-link" href="#">1</a>
</li>
<li class="page-item active">
<a class="page-link" href="#">2</a>
</li>
<li class="page-item">
<a class="page-link" href="#">3</a>
</li>
<li class="page-item">
<a class="page-link" href="#">Next</a>
</li>
</ul>
</nav>

<!-- Card action buttons -->
<div class="card-action text-end">
<button type ="submit" class="btn btn-success" style="width: 91px; height: 36px; padding-left: 6px" onclick="submitForm()">Submit</button>
{% comment %} <button class="btn btn-danger" style="width: 91px; height: 36px; padding-left: 6px">Cancel</button> {% endcomment %}
<button type="button" class="btn btn-danger" style="width: 91px; height: 36px; padding-left: 6px"  onclick="history.back()" >Cancel</button>
</div>
</div>
</div>
</div>

</div>
</div>
</div>

</div>

</div>
</div>
</div>
</div>

</div>

</div>






<!-- ======================table end main content======================== -->

<!-- ====================footer start========================= -->

{% include "./includes/footer.html" %}
</div>
<!-- custom template setting -->
{% include "./includes/template_setting.html" %}
</div>
</div>

<!-- Edit Tax Modals -->
{% for tax in taxes %}
<div class="modal fade" id="editTaxModal{{ tax.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Edit Tax Rate - {{ tax.hsn_code.hsn_code }}</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal Body -->
            <form method="post" action="{% url 'ajserp:edit_tax' tax.id %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="container">
                        <div class="row g-3">
                            {% comment %} <div class="col-md-12">
                                <label class="form-label">HSN Code *</label>
                                <input 
                                    type="text" 
                                    name="hsn_code" 
                                    class="form-control" 
                                    value="{{ tax.hsn_code.hsn_code }}" 
                                    required
                                    readonly
                                    style="background-color: #f8f9fa;"
                                />
                                <small class="text-muted">HSN code cannot be changed</small>
                            </div> {% endcomment %}
                            <div class="col-md-6">
                                <label class="form-label">CGST % *</label>
                                <input 
                                    type="number" 
                                    name="cgst" 
                                    value="{{ tax.cgst }}" 
                                    class="form-control" 
                                    step="0.01" 
                                    min="0" 
                                    max="100" 
                                    required
                                />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">SGST % *</label>
                                <input 
                                    type="number" 
                                    name="sgst" 
                                    value="{{ tax.sgst }}" 
                                    class="form-control" 
                                    step="0.01" 
                                    min="0" 
                                    max="100" 
                                    required
                                />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">IGST % *</label>
                                <input 
                                    type="number" 
                                    name="igst" 
                                    value="{{ tax.igst }}" 
                                    class="form-control" 
                                    step="0.01" 
                                    min="0" 
                                    max="100" 
                                    required
                                />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CESS % *</label>
                                <input 
                                    type="number" 
                                    name="cess" 
                                    value="{{ tax.cess }}" 
                                    class="form-control" 
                                    step="0.01" 
                                    min="0" 
                                    max="100" 
                                    required
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Tax Rate</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Delete Confirmation Modals -->
{% for tax in taxes %}
<div class="modal fade" id="deleteModal{{ tax.id }}">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Delete Confirmation</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <div class="container" style="text-align: center;">
                    <h2>Delete Confirmation</h2><br>
                    <p>Are you sure you want to delete tax rate for HSN {{ tax.hsn_code }}?</p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer" style="display:inline; text-align:center;">
                <form method="post" action="{% url 'ajserp:delete_tax' tax.id %}">
                    {% csrf_token %}
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">No</button>
                    <button type="submit" class="btn btn-success">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}
  {% endblock %}