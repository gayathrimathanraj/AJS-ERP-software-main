{% extends './base.html' %} 
{% load static %}
 {% block content %}
<div class="wrapper">
<!-- Sidebar -->
{% include "./includes/sidebar.html" %}

<div class="main-panel">
<div class="main-header" style="background: content-box !important">
<div class="main-header-logo">
<!-- navbar -->
{% include "./includes/navbar.html" %}

</div>
{% comment %}
====================main content================== {% endcomment %}

<!-- main content -->
<div class="container bg-light">
<div class="page-inner">
{% comment %} <div
class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4"
> {% endcomment %}
 <div class="d-flex justify-content-between align-items-center pt-2 pb-4">
<div>
<!-- page title -->
<h3 class="fw-bold mb-3">Dashboard</h3>
<!-- bread crumbs -->
<ul class="breadcrumbs mb-3">
<li class="nav-home">
<a href="{%url 'ajserp:dashboard'%}">
<i class="icon-home"></i>
</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="#">Dashboard</a>
</li>
</ul>
</div>
<!-- BUTTONS (RIGHT SIDE) -->
 <div class="col-md-3 text-md-end text-start">
        <a href="{% url 'ajserp:add_tracker' %}"
           class="btn btn-primary btn-round"
           style="width: 120px; height: 36px; padding-top: 6px;">
            + Add Tracker
        </a>
    </div>   
</div>

<!-- Stats sections -->
<div class="row">
<div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-primary bubble-shadow-small"
>
<i class="fas fa-exclamation-circle"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Pending Task</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-info bubble-shadow-small"
>
<i class="fas fa-exclamation-circle"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Out Standing</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-success bubble-shadow-small"
>
<i class="fas fa-users"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Employee On Field</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-secondary bubble-shadow-small"
>
<i class="fas fa-wallet"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Advance Request Pending</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-secondary bubble-shadow-small"
>
<i class="fas fa-wallet"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Collection</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div>
 <div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-secondary bubble-shadow-small"
>
<i class="fas fa-wallet"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Other Details</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div> 
 <div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-secondary bubble-shadow-small"
>
<i class="fas fa-wallet"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Other Details</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div>
 <div class="col-sm-6 col-md-3">
<div class="card card-stats card-round">
<div class="card-body">
<div class="row align-items-center">
<div class="col-icon">
<div
class="icon-big text-center icon-secondary bubble-shadow-small"
>
<i class="fas fa-wallet"></i>
</div>
</div>
<div class="col col-stats ms-3 ms-sm-0">
<div class="numbers">
<p class="card-category">Other Details</p>
<h4 class="card-title"></h4>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


<!-- Filter Bar -->
<div class="filter-bar mb-4" style="background: #fff;padding: 12px; border-radius: 12px;box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);">
<form class="row g-2 align-items-center">
<div class="col-auto">
<label class="form-label mb-0 small">From</label>
<input type="date" class="form-control">
</div>
<div class="col-auto">
<label class="form-label mb-0 small">To</label>
<input type="date" class="form-control ">
</div>
<div class="col-auto">
<label class="form-label mb-0 small">Status</label>
<select class="form-select">
<option>All</option>
<option>Open</option>
<option>Closed</option>
</select>
</div>
<div class="col-auto">
<label class="form-label mb-0 small">Task Number</label>
<input type="text" class="form-control">
</div>
<div class="col-auto">
<label class="form-label mb-0 small">Contact Number</label>
<input type="text" class="form-control">
</div>
<div class="col-auto pt-3">
<button class="btn btn-primary btn-sm"> Search</button>
</div>
</form>
</div>




<div class="row">
<div class="col-md-12 col-sm-6">
<div class="card">
<div class="">
<div class="card-body">

<div class="col-md-2">
<input class="form-control form-control-sm mb-3" id="tableSearch" type="text" placeholder="Search...">
</div>
 <form method="POST"
      action="{% url 'ajserp:bulk_assign_trackers' %}"
      id="bulkAssignForm">

    {% csrf_token %}
    <input type="hidden" id="bulkAssignedToHidden" name="assigned_to">

    <div class="d-flex justify-content-between align-items-center mb-2">

        <div>
            <label><strong>Assign Selected To:</strong></label>

            <select id="bulkAssignedTo"
                    class="form-select form-select-sm d-inline-block"
                    style="width: 200px;">
                <option value="">Select User</option>
                {% for u in users %}
                    <option value="{{ u.user.id }}">{{ u.user.username }}</option>
                {% endfor %}
            </select>

            <button type="button" id="bulkAssignBtn"
                    class="btn btn-primary btn-sm ms-2">
                Assign Selected
            </button>
        </div>

    </div>


    {% comment %} <!-- ðŸ”½ INSERTED HERE: BULK ASSIGN + SELECT ALL ðŸ”½ -->
    <div class="d-flex justify-content-between align-items-center mb-2">

        <!-- LEFT: Bulk Assign -->
        <div>
            <label><strong>Assign Selected To:</strong></label>

            <select id="bulkAssignedTo" 
                    class="form-select form-select-sm d-inline-block"
                    style="width: 200px;">
                <option value="">Select User</option>
                {% for u in users %}
                    <option value="{{ u.user.id }}">{{ u.user.username }}</option>
                {% endfor %}
            </select>

            <button type="button" id="bulkAssignBtn" 
                    class="btn btn-primary btn-sm ms-2">
                Assign Selected
            </button>
        </div>

       
    </div>
  <form method="POST"
      action="{% url 'ajserp:bulk_assign_trackers' %}"
      id="bulkAssignForm">

    {% csrf_token %}
    <input type="hidden" id="bulkAssignedToHidden" name="assigned_to">

    <div class="d-flex justify-content-between align-items-center mb-2">

        <div>
            <label><strong>Assign Selected To:</strong></label>

            <select id="bulkAssignedTo"
                    class="form-select form-select-sm d-inline-block"
                    style="width: 200px;">
                <option value="">Select User</option>
                {% for u in users %}
                    <option value="{{ u.user.id }}">{{ u.user.username }}</option>
                {% endfor %}
            </select>

            <button type="button" id="bulkAssignBtn"
                    class="btn btn-primary btn-sm ms-2">
                Assign Selected
            </button>
        </div>

    </div>
 
{% comment %} ============================table start============ {% endcomment %}

<div class="table-responsive">

{% comment %} <table id="basic-datatables" class="table table-bordered table-sm table-striped table-hover align-middle text-center"> {% endcomment %}
<div class="table-responsive mt-4">
    <table class="table table-bordered table-striped table-hover text-center align-middle">
        <thead class="table-light">
            <tr>
              
    <th>
    <input type="checkbox" id="selectAll">
</th>

                <th>Tracker No</th>
                <th>Application ID</th>
                <th>Name</th>
                <th>Contact No</th>
                <th>Email</th>
                <th>Remark</th>

                <th>Status</th>
                <th>Assigned To</th>

                <th>Customer</th>
                <th>Customer City</th>

                <th>Login Time</th>
                <th>Logout Time</th>
                <th>Check-in Time</th>
                <th>Check-out Time</th>

                <th>Work Completed</th>
                <th>Work Text</th>
                <th>Image</th>
            </tr>
        </thead>

        <tbody>
    {% for t in trackers %}
    <tr>
         <td>
       <input type="checkbox" value="{{ t.id }}" class="tracker-checkbox">

    </td>
        <td>{{ t.tracker_no }}</td>
        <td>{{ t.application_id }}</td>
        <td>{{ t.name }}</td>
        <td>{{ t.contact_no }}</td>
        <td>{{ t.email }}</td>
        <td>{{ t.remark|default:"--" }}</td>

        <!-- STATUS -->
        <td>
            {% if t.status == "pending" %}
                <span class="badge bg-warning">Pending</span>
            {% elif t.status == "assigned" %}
                <span class="badge bg-info">Assigned</span>
            {% else %}
                <span class="badge bg-secondary">{{ t.status }}</span>
            {% endif %}
        </td>

        <!-- ASSIGNED TO DROPDOWN FROM USERPROFILE -->
        {% comment %} <td>
            <form method="POST" action="{% url 'ajserp:update_assignment' t.id %}">
                {% csrf_token %}
                <select name="assigned_to"
                        class="form-select form-select-sm"
                        onchange="this.form.submit()">

                    <option value="">Select User</option>

                    {% for u in users %}
                        <option value="{{ u.user.id }}"
                            {% if t.assigned_to and t.assigned_to.id == u.user.id %}selected{% endif %}>
                            {{ u.user.username }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </td> {% endcomment %}
        <td>
    {% if t.assigned_to %}
        {{ t.assigned_to.username }}
    {% else %}
        --
    {% endif %}
</td>


        <!-- rest of your columns -->
        <td style="position: relative;">
    <input type="text" 
           class="form-control form-control-sm customer-search"
           data-tracker="{{ t.id }}"
           value="{% if t.customer %}{{ t.customer.customer_name }}{% endif %}"
           placeholder="Search Customer">
</td>

<td>
    <input type="text" 
           class="form-control form-control-sm customer-city"
           value="{{ t.customer_city|default:'' }}"
           placeholder="City"
           readonly>
</td>


        <td>{{ t.login_time|date:"d-m-Y H:i" }}</td>
        <td>{{ t.logout_time|date:"d-m-Y H:i" }}</td>
        <td>{{ t.check_in_time|date:"d-m-Y H:i" }}</td>
        <td>{{ t.check_out_time|date:"d-m-Y H:i" }}</td>

        <td>
            {% if t.work_completed %}
                {{ t.work_completed|title }}
            {% else %}
                --
            {% endif %}
        </td>

        <td>{{ t.work_text|default:"--" }}</td>

        <td>
            {% if t.image %}
                <img src="{{ t.image.url }}" width="50" height="50"
                     style="object-fit:cover; border-radius:6px;">
            {% else %}
                --
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</tbody>


    </table>

</div>
</form>
{% comment %} <!-- ðŸ”½ ADD THIS EXACT HIDDEN FORM HERE ðŸ”½ -->
<form id="bulkAssignForm"
      method="POST"
      action="{% url 'ajserp:bulk_assign_trackers' %}"
      style="display:none;">
    {% csrf_token %}
    <input type="hidden" name="assigned_to" id="bulkAssignedToHidden">
</form>
<!-- ðŸ”¼ END HIDDEN FORM ðŸ”¼ --> {% endcomment %}

<nav aria-label="Page navigation example">
                                <ul class="pagination justify-content-end">
                                  <li class="page-item disabled">
                                    <a class="page-link">Previous</a>
                                  </li>
                                  <li class="page-item">
                                    <a class="page-link" href="#">1</a>
                                  </li>
                                  <li class="page-item active">
                                    <a class="page-link" href="#">2</a>
                                  </li>
                                  <li class="page-item">
                                    <a class="page-link" href="#">3</a>
                                  </li>
                                  <li class="page-item">
                                    <a class="page-link" href="#">Next</a>
                                  </li>
                                </ul>
                              </nav>

</div>
</div>
</div>
</div>
</div>



</div>

</div>



<!-- ======================table end main content======================== -->

<!-- ====================footer start========================= -->

{% include "./includes/footer.html" %}
</div>
<!-- custom template setting -->
{% include "./includes/template_setting.html" %}
</div>
{%Â endblockÂ %}
