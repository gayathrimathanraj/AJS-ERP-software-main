{% extends './base.html' %}

{% load static %}
{% block content %}

<div class="wrapper">
<!-- Sidebar -->
{% include "./includes/sidebar.html" %}
<div class="main-panel">
<div class="main-header" style="background:content-box !important;">
<div class="main-header-logo">
<!-- navbar -->
{% include "./includes/navbar.html" %}
</div>

<!--main content-->

<div class="container">
<div class="page-inner ps-2 pe-2">
<div class="page-header">
<h3 class="fw-bold mb-3">Create Material</h3>
<ul class="breadcrumbs mb-3">
<li class="nav-home">
<a href="{%url 'ajserp:dashboard'%}">
<i class="icon-home"></i>
</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
addMaterial</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="material.html">Material</a>
</li>

</ul>
</div>
<!-- ============add table start============= -->
<div class="card">
<!-- Card header with title and Active checklist -->
<div class="card-header d-flex justify-content-between align-items-center">
<div class="card-title mb-0">Create material</div>

<div class="d-flex align-items-center">
<label class="form-label me-3 mb-1">Active:</label>
<div class="form-check form-check-inline pb-2 ps-3">
<input class="form-check-input" type="checkbox" id="activeYes" name="active_status" value="True" checked>
<label class="form-check-label" for="activeYes">Yes</label>
</div>
<div class="form-check form-check-inline pb-2 ps-3">
<input class="form-check-input" type="checkbox" id="activeNo" name="active_status" value="False">
<label class="form-check-label" for="activeNo">No</label>
</div> 
{% comment %} <div class="form-check form-check-inline pb-2 ps-3">
    <input class="form-check-input" type="checkbox" id="activeYes" name="active_status" value="true" checked>
    <label class="form-check-label" for="activeYes">Active Material</label>
</div> {% endcomment %}
</div>
</div>

 <!-- Django Form Starts Here -->
<form method="POST"  enctype="multipart/form-data" >
{% csrf_token %}
<!-- Card body (unchanged) -->
<div class="card-body">
<div class="row">
<!-- Column 1 -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="text">Material code</label>
<input type="text" class="form-control" id="materialCode"  readonly value="Auto-generated based on category"/>
</div>
</div>

<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="category">Category</label>
<select class="form-select" id="category" name="category" required>
<option>Select Category</option>
<option>Service</option>
<option>Material</option>
<option>Spare</option>
</select> 
</div>
</div>

<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="uom">UOM</label>
<select class="form-select" id="uom" name="uom" required>
<option>Select UOM</option>
<option>KG</option>
<option>No</option>
<option>Meter</option>
<option>Lot</option>
<option>Pack</option>
<option>Set</option>
<option>EA</option>
</select> 
</div>
</div>


<!-- Column 2 -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="materialName">Material Name</label>
<input type="text" class="form-control" id="materialName"  name="material_name" required/>
</div>
</div>


<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="exampleFormControlSelect1">Model</label>
<select class="form-select" id="model" name="model" required>
<option value="">Select Model</option>
{% for model in material_models %}
<option value="{{ model.name }}">{{ model.name }}</option>
{% endfor %}
</select> 
</div>
</div>

{% comment %} <div class="col-md-6 col-lg-4">
<div class="form-group">
  <label for="hsnCode">HSN Code</label>
  <input type="text" name="hsn_code" class="form-control" placeholder="HSN Code..." aria-label="Search" required/> {% endcomment %}
  {% comment %} <select class="form-select" id="hsnCode" name="taxes" required>
    <option value="">Select HSN Code</option>
    {% for tax in taxes%}
      <option value="{{ tax.hsn_code }}">{{ tax.hsn_code }}</option>
    {% endfor %}
  </select> {% endcomment %}
{% comment %} </div>
</div> {% endcomment %}

<!-- HSN Code Section with Popup Button -->
{% comment %} <div class="col-md-6 col-lg-4">
<div class="form-group">
  <label for="hsnCode">HSN Code</label>
  <div class="input-group">
    <input type="text" name="hsn_code" class="form-control" placeholder="HSN Code..." 
           value="{{ selected_hsn_code|default:'' }}" required id="hsnCodeInput"/>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#hsnCodeModal">
      <i class="fas fa-plus"></i> Add
    </button>
  </div>
  {% if selected_hsn_code %}
  <small class="text-success">Selected HSN: {{ selected_hsn_code }}</small>
  {% endif %}
</div>
</div> {% endcomment %}

<!-- HSN Code Section with Popup Button -->
<div class="col-md-6 col-lg-4">
<div class="form-group">
  <label for="hsnCode">HSN Code</label>
  <div class="input-group">
    <input 
        type="text" 
        name="hsn_code" 
        class="form-control" 
        placeholder="Enter HSN Code" 
        value="{{ selected_hsn_code|default:'' }}"
        maxlength="10"
        required
    />
    {% comment %} <input type="text" name="hsn_code" class="form-control" placeholder="HSN Code..." 
           value="{{ selected_hsn_code|default:'' }}" required id="hsnCodeInput" readonly/> {% endcomment %}
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#hsnCodeModal">
      Add HSN Code
    </button>
  </div>
  {% if selected_hsn_code %}
  <small class="text-success">Selected HSN: {{ selected_hsn_code }}</small>
  {% endif %}
</div>
</div>



<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="description">Description</label>
<textarea class="form-control" id="description"  name="description" aria-label="With textarea"></textarea> 
</div>
</div>


<div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="brand">Select Brand</label>
<select class="form-select" id="brand" name="brand" required>
    <option value="">Select Brand</option>
    {% for brand in material_brands %}
        <option value="{{ brand.name }}">{{ brand.name }}</option>
    {% endfor %}
</select>
</div>
</div>

{% comment %} <div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="purchasePrice">MRP</label>
<input type="number" class="form-control" id="purchasePrice" name="mrp" step="0.01" placeholder="0.00">
</div>
</div>


  <div class="col-md-6 col-lg-4">
    <div class="form-group">
      <label for="sellingPrice">Selling Price</label>
      <input type="number" class="form-control" id="sellingPrice" name="selling_price" step="0.01" placeholder="0.00">
    </div> 
  </div> {% endcomment %}

    <div class="col-md-6 col-lg-4">  
    <div class="form-group">
      <label for="uploadImages" class="form-label mb-1">Upload Images</label>
      <input type="file" class="form-control" id="uploadImages" name="image"/> 
    </div>
  </div>
  </div>
</div>
</div>
{% comment %} <div class="col-md-6 col-lg-4">
<div class="form-group">
<label for="sellingPrice">Selling Price</label>
<input type="number" class="form-control" id="sellingPrice" name="selling_price" step="0.01" placeholder="0.00">
</div> 

<div class="form-group">
<label for="uploadImages" class="form-label mb-1">Upload Images</label>
<input type="file" class="form-control" id="uploadImages" name="image"/> 
</div>
</div>
</div>
</div> {% endcomment %}


<!-- Card action buttons -->
<div class="card-action text-end">
<button type="submit" class="btn btn-success">Submit</button>
{% comment %} <button type ="submit" class="btn btn-success" style="width: 91px; height: 36px; padding-left: 6px" onclick="submitForm()">Submit</button> {% endcomment %}
{% comment %} <button class="btn btn-danger" style="width: 91px; height: 36px; padding-left: 6px">Cancel</button> {% endcomment %}
<button type="button" class="btn btn-danger" style="width: 91px; height: 36px; padding-left: 6px"  onclick="history.back()" >Cancel</button>
</div>
<!--Django form ends here-->
</form>

</div>
</div>

<!-- HSN Code Modal Popup -->
<div class="modal fade" id="hsnCodeModal">
  <div class="modal-dialog modal-lg" style="--bs-modal-width: 737px !important">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Manage HSN Codes</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <!-- Create New HSN Code Form -->
        <div class="card mb-4">
          <div class="card-header text-black">
            <h6 class="card-title mb-0">Create New HSN Code</h6>
          </div>
          <div class="card-body">
            <form method="POST" action="{% url 'ajserp:create_hsn_code' %}">
              {% csrf_token %}
              <input type="hidden" name="redirect_to" value="addmaterial">
              <div class="row">
                <div class="col-md-8">
                  <div class="form-group">
                    <label for="new_hsn_code" class="form-label">HSN Code *</label>
                    <input type="text" name="hsn_code" class="form-control" maxlength="10" required 
                           placeholder="e.g., 1234">
                  </div>
                </div>

                 {% comment %} <!-- Tax Fields Row -->
              <div class="row mt-3">
                <!-- CGST -->
                <div class="col-md-6 col-lg-3">
                  <div class="form-group">
                    <label for="Taxmaster">CGST (%) *</label>
                    <input
                        type="number"
                        name="cgst"
                        class="form-control"
                        placeholder="CGST %"
                        step="0.01"
                        min="0"
                        max="100"
                        required
                    />
                  </div>
                </div>

                <!-- SGST -->
                <div class="col-md-6 col-lg-3">
                  <div class="form-group">
                    <label for="Taxmaster">SGST (%) *</label>
                    <input
                        type="number"
                        name="sgst"
                        class="form-control"
                        placeholder="SGST %"
                        step="0.01"
                        min="0"
                        max="100"
                        required
                    />
                  </div>
                </div>

                <!-- IGST -->
                <div class="col-md-6 col-lg-3">
                  <div class="form-group">
                    <label for="Taxmaster">IGST (%) *</label>
                    <input
                        type="number"
                        name="igst"
                        class="form-control"
                        placeholder="IGST %"
                        step="0.01"
                        min="0"
                        max="100"
                        required
                    />
                  </div>
                </div>

                <!-- CESS -->
                <div class="col-md-6 col-lg-3">
                  <div class="form-group">
                    <label for="Taxmaster">CESS (%) *</label>
                    <input
                        type="number"
                        name="cess"
                        class="form-control"
                        placeholder="CESS %"
                        step="0.01"
                        min="0"
                        max="100"
                        required
                    />
                  </div>
                </div>
              </div> {% endcomment %}

                <div class="col-md-4">
                  <div class="form-group">
                    <label class="form-label" style="visibility: hidden;">Action</label>
                    <div class="d-grid">
                      <button type="submit" class="btn btn-success">Create HSN Code</button>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Existing HSN Codes Table -->
        <div class="card">
          <div class="card-header text-black">
            <h6 class="card-title mb-0">Existing HSN Codes</h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>HSN Code</th>
                    {% comment %} <th>CGST</th>
                    <th>SGST</th>
                    <th>IGST</th>
                    <th>CESS</th> {% endcomment %}
                    <th>Created Date</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for hsn in hsn_codes %}
                  <tr>
                    <td><strong>{{ hsn.hsn_code }}</strong></td>
                     {% comment %} <td>{{ hsn.cgst }}%</td>
                    <td>{{ hsn.sgst }}%</td>
                    <td>{{ hsn.igst }}%</td>
                    <td>{{ hsn.cess }}%</td> {% endcomment %}
                    <td>{{ hsn.created_at|date:"d/m/Y" }}</td>
                    <td>
                      <form method="POST" action="{% url 'ajserp:select_hsn_code' %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="hsn_code" value="{{ hsn.hsn_code }}">
                        <input type="hidden" name="redirect_to" value="addmaterial">
                        <button type="submit" class="btn btn-sm btn-primary">
                          <i class="fas fa-check"></i> Use This
                        </button>
                      </form>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="3" class="text-center py-4">
                      <i class="fas fa-info-circle text-muted"></i>
                      No HSN codes found. Create one above.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>


<!-- ==========================footer===================== -->

{% include "./includes/footer.html" %}
</div>
<!-- custom template setting -->
{% include "./includes/template_setting.html" %}
</div>

{% endblock %}