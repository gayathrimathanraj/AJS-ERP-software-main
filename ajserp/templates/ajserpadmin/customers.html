{% extends './base.html' %} 
{% load static %} 
{% block content %}
<div class="wrapper">
<!-- Sidebar -->
{% include "./includes/sidebar.html" %}

<div class="main-panel">
<div class="main-header" style="background: content-box !important">
<div class="main-header-logo">
<!-- navbar -->
{% include "./includes/navbar.html" %}
</div>

<!--main content-->

<div class="container">
<div class="row">
<div class="">
<h3 class="fw-bold ms-3 ps-3 pt-3">Customers</h3>
<div class="page-header mt-1">
<div class="col-md-9">
<ul class="breadcrumbs mb-3">
<li class="nav-home">
<a href="{%url 'ajserp:dashboard'%}">
<i class="icon-home"></i>
</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="#">Customers</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="#">Customers</a>
</li>
</ul>
</div>
<div class="col-md-3 text-end">
<p class="demo">
<button
type="button"
data-bs-toggle="modal"
data-bs-target="#myModalimport"
title=""
class="btn btn-primary btn-round"
data-original-title=""
style="width: 91px; height: 36px"
>
Import
</button>
<a
href="{%url 'ajserp:addcustomers'%}"
class="btn btn-primary btn-round"
style="width: 91px; height: 36px;padding-top: 6px;"
>Add</a
>
</p>
<!-- ========import model================== -->
<div class="modal fade" id="myModalimport">
<div class="modal-dialog">
<div class="modal-content">
<!-- Modal Header -->
<div class="modal-header">
<h4 class="modal-title">Import Items</h4>
<button
type="button"
class="btn-close"
data-bs-dismiss="modal"
></button>
</div>

<!-- Modal body -->
<div class="modal-body">
<div class="container" style="text-align: center">
<h2></h2>
<br />
<div class="mb-3">
<input
class="form-control"
type="file"
id="formFile"
/>
</div>
<p>Required : Name, Unit and Sell Price</p>
</div>
</div>
<!-- Modal footer -->
<div class="modal-footer">
<button
type="button"
class="btn btn-success"
data-bs-dismiss="modal"
>
Submit
</button>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- ================================= table start======================== -->

<div class="container-fluid">
<div class="col-md-12">
<div class="card">
<div class="">
<div class="card-body" style="padding: 1.25rem">
<div class="container mt-3">
<div class="card p-4">
<!-- First Row: Filters + Search Button -->
<div class="row g-3 align-items-end mb-2">
<!-- Material Code -->
<div class="col-md-4">
<input
type="text"
class="form-control"
placeholder="Customer Name..."
aria-label="Search"
/>
</div>

<!-- Category -->
<div class="col-md-3">
<select class="form-select" id="categorySelect">
<option selected>Select Category</option>
<option>Service</option>
<option>Material</option>
<option>Spare</option>
</select>
</div>

<!-- Model -->
<div class="col-md-2">
<select class="form-select" id="statusSelect">
<option selected>Select Status</option>
<option>Active</option>
<option>Draft</option>
</select>
</div>

<!-- Search Button -->
<div class="col-md-2">
<button type="submit" class="btn btn-primary w-50">Search</button>
</div>
</div>
</div>

<!-- Second Row: Only Dates -->
</div>

{% comment %} ============================table
start============ {% endcomment %}
<div class="row">
<div class="col-md-12">
<div class="card">
<div class="">
<div class="">
<!-- bg-light = light gray background -->
<div class="card-body">
<div class="d-flex gap-2">
<div
class="d-flex justify-content-between"
style="width: 95%"
>
<!-- Left Search Box -->
<form method="GET" class="input-group" style="width: 300px">
<input type="text" name="q" class="form-control" placeholder="Search here..." value="{{ request.GET.q }}"/>
<button class="btn btn-primary" type="submit">Search</button>
</form>
{% comment %} <div class="input-group" style="width: 300px">
<input type="text" class="form-control" placeholder="Search here..." aria-label="Search"/>
<button class="btn btn-primary" type="button">Search</button>
</div> {% endcomment %}
</div>
</div>
</div>
<div class="table-responsive">
<table id="basic-datatables"
class="display table table-bordered table-sm table-striped align-middle table-hover text-center" style="border: 1px solid #d2caca;"
>
<thead style="padding: 13px 9px !important">
<tr>
<th>
<input type="checkbox" id="selectAll">
</th>
<th>
Customer&nbsp;Code
</th>

<th>
Customer&nbsp;Name
</th>
<th>
Group
</th>
<th>
Category
</th>
<th>
GST&nbsp;Number
</th>
<th>
PAN&nbsp;Number
</th>
<th>
Contact&nbsp;Person
</th>
<th>
Contact&nbsp;Number
</th>
<th>
Action
</th>
</tr>
</thead>
<tbody>
{% for customer in customers %}
<tr>
<td style="padding: 0px !important">
<input type="checkbox" class="rowCheckbox">
</td>
<td>
<a href="#" data-bs-toggle="modal" data-bs-target="#myModalcustomer{{ customer.id }}">{{ customer.id }}</a></td>
<td>{{ customer.customer_name }}</td>
<td>{{ customer.customer_group.name|default:"-" }}</td>
<td>{{ customer.category.name|default:"-" }}</td>
<td>{{ customer.gst_number|default:"-" }}</td>
<td>{{ customer.pan_no|default:"-" }}</td>
<td>{{ customer.contact_person }}</td>
<td>{{ customer.contact_number }}</td>
<td>
<div class="form-button-action">
<!-- Edit Button -->
<button type="button" 
data-bs-toggle="modal" 
data-bs-target="#editModal{{ customer.id }}"
class="btn btn-link btn-primary btn-lg"
title="Edit Customer">
<i class="fa fa-edit"></i>
</button>

<!-- Delete Button -->
<button type="button"
data-bs-toggle="modal"
data-bs-target="#deleteModal{{ customer.id }}"
class="btn btn-link btn-danger"
title="Delete Customer">
<i class="fa fa-times"></i>
</button>
</div>
</td>
</tr>
{% empty %}
<tr>
<td colspan="10" class="text-center">No customers found.</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
<nav aria-label="Page navigation example">
<ul class="pagination justify-content-end">
<li class="page-item disabled">
<a class="page-link">Previous</a>
</li>
<li class="page-item">
<a class="page-link" href="#">1</a>
</li>
<li class="page-item active">
<a class="page-link" href="#">2</a>
</li>
<li class="page-item">
<a class="page-link" href="#">3</a>
</li>
<li class="page-item">
<a class="page-link" href="#">Next</a>
</li>
</ul>
</nav>
<!--  Delete The Modal start -->

<div class="modal fade" id="myModaldelete">
<div class="modal-dialog">
<div class="modal-content">
<!-- Modal Header -->
<div class="modal-header">
<h4 class="modal-title"></h4>
<button
type="button"
class="btn-close"
data-bs-dismiss="modal"
></button>
</div>
<!-- Modal body -->
<div class="modal-body">
<div
class="container"
style="text-align: center"
>
<h2>Delete Confirmation</h2>
<br />
<p>
Are you sure you want to delete this
Estimate account?
</p>
</div>
</div>
<!-- Modal footer -->
<div
class="modal-footer"
style="display: inline; text-align: center"
>
<button
type="button"
class="btn btn-success"
data-bs-dismiss="modal"
>
Yes
</button>
<button
type="button"
class="btn btn-danger"
data-bs-dismiss="modal"
>
No
</button>
</div>
</div>
</div>
</div>
<!--  Delete Modal end -->


</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- ======================table end main content======================== -->

<!-- ====================footer start========================= -->

{% include "./includes/footer.html" %}
</div>
<!-- custom template setting -->
{% include "./includes/template_setting.html" %}
</div>
</div>

<!-- ==================== EDIT/DELETE MODALS ==================== -->
{% for customer in customers %}

<!-- CUSTOMER VIEW MODAL -->
<div class="modal fade" id="myModalcustomer{{ customer.id }}">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">

            <!-- HEADER -->
            <div class="modal-header">
                <h4 class="modal-title">Customer Details</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- BODY -->
            <div class="modal-body">
                <div class="row g-3">

                    <!-- CUSTOMER CODE -->
                    <div class="col-md-4">
                        <label class="form-label">Customer Code</label>
                        <input type="text" class="form-control" value="{{ customer.id }}" readonly>
                    </div>

                    <!-- CUSTOMER NAME -->
                    <div class="col-md-4">
                        <label class="form-label">Customer Name</label>
                        <input type="text" class="form-control" value="{{ customer.customer_name }}" readonly>
                    </div>

                    <!-- CONTACT PERSON -->
                    <div class="col-md-4">
                        <label class="form-label">Contact Person</label>
                        <input type="text" class="form-control" value="{{ customer.contact_person }}" readonly>
                    </div>

                    <!-- CONTACT NUMBER -->
                    <div class="col-md-4">
                        <label class="form-label">Contact Number</label>
                        <input type="text" class="form-control" value="{{ customer.contact_number }}" readonly>
                    </div>

                    <!-- EMAIL -->
                    <div class="col-md-4">
                        <label class="form-label">Email Address</label>
                        <input type="text" class="form-control" value="{{ customer.email_address }}" readonly>
                    </div>

                    <!-- ALT CONTACT -->
                    <div class="col-md-4">
                        <label class="form-label">Alternate Number</label>
                        <input type="text" class="form-control" value="{{ customer.alt_contact_no }}" readonly>
                    </div>

                    <!-- GROUP -->
                    <div class="col-md-4">
                        <label class="form-label">Customer Group</label>
                        <input type="text" class="form-control" value="{{ customer.customer_group.name|default:'-' }}" readonly>
                    </div>

                    <!-- CATEGORY -->
                    <div class="col-md-4">
                        <label class="form-label">Customer Category</label>
                        <input type="text" class="form-control" value="{{ customer.category.name|default:'-' }}" readonly>
                    </div>

                    <!-- GST -->
                    <div class="col-md-4">
                        <label class="form-label">GST Number</label>
                        <input type="text" class="form-control" value="{{ customer.gst_number|default:'-' }}" readonly>
                    </div>

                    <!-- PAN -->
                    <div class="col-md-4">
                        <label class="form-label">PAN Number</label>
                        <input type="text" class="form-control" value="{{ customer.pan_no|default:'-' }}" readonly>
                    </div>

                    <!-- CREDIT PERIOD -->
                    <div class="col-md-4">
                        <label class="form-label">Credit Period</label>
                        <input type="text" class="form-control" value="{{ customer.credit_period|default:'-' }}" readonly>
                    </div>

                    <!-- CREDIT LIMIT -->
                    <div class="col-md-4">
                        <label class="form-label">Credit Limit</label>
                        <input type="text" class="form-control" value="{{ customer.credit_limit|default:'-' }}" readonly>
                    </div>

                </div>

                <hr>

                <!-- BILLING ADDRESS -->
                <h5 class="mt-3">Billing Address</h5>
                <div class="row g-3">

                    <div class="col-md-6">
                        <label class="form-label">Address 1</label>
                        <input type="text" class="form-control" value="{{ customer.billing_address1 }}" readonly>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Address 2</label>
                        <input type="text" class="form-control" value="{{ customer.billing_address2|default:'-' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" value="{{ customer.billing_city }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">State</label>
                        <input type="text" class="form-control" value="{{ customer.billing_state }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Postal Code</label>
                        <input type="text" class="form-control" value="{{ customer.billing_postal_code }}" readonly>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Country</label>
                        <input type="text" class="form-control" value="{{ customer.billing_country }}" readonly>
                    </div>

                </div>

                <hr>

                <!-- SHIPPING ADDRESS -->
                <h5 class="mt-3">Shipping Address</h5>
                <div class="row g-3">

                    <div class="col-md-6">
                        <label class="form-label">Address 1</label>
                        <input type="text" class="form-control" value="{{ customer.shipping_address1 }}" readonly>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Address 2</label>
                        <input type="text" class="form-control" value="{{ customer.shipping_address2|default:'-' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" value="{{ customer.shipping_city }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">State</label>
                        <input type="text" class="form-control" value="{{ customer.shipping_state }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Postal Code</label>
                        <input type="text" class="form-control" value="{{ customer.shipping_postal_code }}" readonly>
                    </div>

                </div>

                {% if customer.image %}
                <hr>
                <h5 class="mt-3">Customer Image</h5>
                <img src="{{ customer.image.url }}" class="img-fluid rounded" width="180">
                {% endif %}

            </div>

            <!-- FOOTER -->
            <div class="modal-footer">
                <button class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<!-- Edit Modal for {{ customer.id }} -->
<div class="modal fade" id="editModal{{ customer.id }}">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit Customer</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{% url 'ajserp:edit_customer' customer.id %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Customer Name *</label>
                                <input type="text" name="customer_name" class="form-control" value="{{ customer.customer_name }}" required>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Contact Person</label>
                                <input type="text" name="contact_person" class="form-control" value="{{ customer.contact_person }}">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Contact Number</label>
                                <input type="text" name="contact_number" class="form-control" value="{{ customer.contact_number }}">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" name="email_address" class="form-control" value="{{ customer.email_address }}">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Alt Contact Number</label>
                                <input type="text" name="alt_contact_no" class="form-control" value="{{ customer.alt_contact_no|default:'' }}">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Customer Group</label>
                                <select class="form-select" name="customer_group">
                                    <option value="">Select Customer Group</option>
                                    {% for group in customer_groups %}
                                    <option value="{{ group.code }}" {% if customer.customer_group.code == group.code %}selected{% endif %}>
                                        {{ group.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Customer Category</label>
                                <select class="form-select" name="category">
                                    <option value="">Select Customer Category</option>
                                    {% for category in customer_categories %}
                                    <option value="{{ category.code }}" {% if customer.category.code == category.code %}selected{% endif %}>
                                        {{ category.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>GST Number</label>
                                <input type="text" name="gst_number" class="form-control" value="{{ customer.gst_number }}">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>PAN Number</label>
                                <input type="text" name="pan_no" class="form-control" value="{{ customer.pan_no }}">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Credit Period</label>
                                <select class="form-select" name="credit_period">
                                    <option value="">Select credit period</option>
                                    <option value="7" {% if customer.credit_period == 7 %}selected{% endif %}>7 Days</option>
                                    <option value="15" {% if customer.credit_period == 15 %}selected{% endif %}>15 Days</option>
                                    <option value="30" {% if customer.credit_period == 30 %}selected{% endif %}>30 Days</option>
                                    <option value="60" {% if customer.credit_period == 60 %}selected{% endif %}>60 Days</option>
                                    <option value="90" {% if customer.credit_period == 90 %}selected{% endif %}>90 Days</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>Credit Limit</label>
                                <input type="number" name="credit_limit" class="form-control" value="{{ customer.credit_limit }}">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label>State of Supply</label>
                                <input type="text" name="state_of_supply" class="form-control" value="{{ customer.state_of_supply }}">
                            </div>
                        </div>
                    </div>

                    <!-- Billing Address -->
                    <h6 class="mt-4"><b>Billing Address</b></h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Address 1</label>
                                <input type="text" name="billing_address1" class="form-control" value="{{ customer.billing_address1 }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Address 2</label>
                                <input type="text" name="billing_address2" class="form-control" value="{{ customer.billing_address2|default:'' }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>City</label>
                                <input type="text" name="billing_city" class="form-control" value="{{ customer.billing_city }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>State</label>
                                <input type="text" name="billing_state" class="form-control" value="{{ customer.billing_state }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Postal Code</label>
                                <input type="text" name="billing_postal_code" class="form-control" value="{{ customer.billing_postal_code }}">
                            </div>
                        </div>
                    </div>
<div class="col-md-6">
    <div class="form-group">
        <label>Country</label>
        <input type="text" name="billing_country" class="form-control"
               value="{{ customer.billing_country }}">
    </div>
</div>

                    <!-- Shipping Address -->
                    <h6 class="mt-4"><b>Shipping Address</b></h6>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="same_as_billing{{ customer.id }}" name="same_as_billing" {% if customer.same_as_billing %}checked{% endif %}>
                        <label class="form-check-label" for="same_as_billing{{ customer.id }}">Same as Billing Address</label>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Address 1</label>
                                <input type="text" name="shipping_address1" class="form-control" value="{{ customer.shipping_address1 }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Address 2</label>
                                <input type="text" name="shipping_address2" class="form-control" value="{{ customer.shipping_address2|default:'' }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>City</label>
                                <input type="text" name="shipping_city" class="form-control" value="{{ customer.shipping_city }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>State</label>
                                <input type="text" name="shipping_state" class="form-control" value="{{ customer.shipping_state }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Postal Code</label>
                                <input type="text" name="shipping_postal_code" class="form-control" value="{{ customer.shipping_postal_code }}">
                            </div>
                        </div>
                    </div>
<div class="col-md-6">
    <div class="form-group">
        <label>Country</label>
        <input type="text" name="shipping_country" class="form-control"
               value="{{ customer.shipping_country }}">
    </div>
</div>

                    <!-- Image Upload -->
                    <div class="form-group mt-3">
                        <label for="image">Customer Image</label>
                        <input type="file" class="form-control" id="image" name="image">
                        {% if customer.image %}
                        <small class="text-muted">Current: {{ customer.image.name }}</small>
                        {% endif %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Modal for {{ customer.id }} -->
<div class="modal fade" id="deleteModal{{ customer.id }}">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete Confirmation</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{% url 'ajserp:delete_customer' customer.id %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="container" style="text-align: center">
                        <p>Are you sure you want to delete <strong>{{ customer.customer_name }}</strong>?</p>
                        <p class="text-danger"><small>This action cannot be undone.</small></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Yes, Delete</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}
{% endblock %}