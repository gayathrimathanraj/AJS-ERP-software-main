{% extends './base.html' %}

{% load static %}
{% block content %}
<div class="wrapper">
<!-- Sidebar -->
{% include "./includes/sidebar.html" %}

<div class="main-panel">
<div class="main-header" style="background:content-box !important;">
<div class="main-header-logo">
<!-- navbar -->
{% include "./includes/navbar.html" %}
</div>

<!--main content-->

<div class="container">
<div class="row">

<h3 class="fw-bold ms-3 ps-3 pt-3">Material Inward</h3>
<div class="page-header mt-1">
<div class="col-md-9">
<ul class="breadcrumbs mb-3">
<li class="nav-home">
<a href="{%url 'ajserp:dashboard'%}">
<i class="icon-home"></i>
</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="#">Inventory</a>
</li>
<li class="separator">
<i class="icon-arrow-right"></i>
</li>
<li class="nav-item">
<a href="#">Material Inward</a>
</li>
</ul>
</div>

<div class="col-md-3 text-end">
<p class="demo">
<button type="button" data-bs-toggle="modal" data-bs-target="#myModalimport" title=" "class="btn btn-primary btn-round" data-original-title="" style="width: 91px;height: 36px;">
Import
</button>
<a href="{%url 'ajserp:addmaterialinward'%}"  class="btn btn-primary btn-round" style="width:91px;height: 36px;padding-top: 6px;">Add</a>
</p>
<!-- ========import model================== -->
<div class="modal fade" id="myModalimport">
<div class="modal-dialog">
<div class="modal-content">
<!-- Modal Header -->
<div class="modal-header">
<h4 class="modal-title">Import Items</h4>
<button
type="button"
class="btn-close"
data-bs-dismiss="modal"
></button>
</div>

<!-- Modal body -->
<div class="modal-body">
<div class="container" style="text-align: center">
<h2></h2>
<br />
<div class="mb-3">
<input
class="form-control"
type="file"
id="formFile"
/>
</div>
<p>Required : Name, Unit and Sell Price</p>
</div>
</div>
<!-- Modal footer -->
<div class="modal-footer">
<button
type="button"
class="btn btn-success"
data-bs-dismiss="modal"
>
Submit
</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>



<div class="container-fluid">
<div class="col-md-12">
<div class="card">
<div class="">
<div class="card-body" style="padding: 1.25rem">
<div class="container mt-3">
<div class="card p-4">
<form method="GET" class="row g-3 align-items-end mb-2">
<!-- Material name -->
<!--<div class="col-md-3">
<label class="form-label">Material Name</label>
<input type="text" name="material_name" class="form-control" placeholder="Material Name..." 
       value="{{ request.GET.material_name }}" list="allMaterialNames" autocomplete="off">
</div>-->

<!-- Material Name with Suggestions -->
 <div class="col-md-3 position-relative d-block"><!-- Bootstrap positioning -->
    <label class="form-label">Material Name</label>
    <input type="text" 
           class="form-control" 
           name="material_name" 
           placeholder="Material Name..." 
           value="{{ request.GET.material_name }}"
           autocomplete="off"
           oninput="showMaterialNameSuggestions(this.value)"
           id="materialNameInput"/>
    <div id="materialNameSuggestions" class="dropdown-menu w-100"></div> <!-- w-100 for full width -->
</div>

<!-- GRN Number with Suggestions -->
<div class="col-md-2 position-relative">
    <label class="form-label">GRN Number</label>
    <input type="text" 
           class="form-control" 
           name="grn_number" 
           placeholder="GRN Number..." 
           value="{{ request.GET.grn_number }}"
           autocomplete="off"
           oninput="showGrnSuggestions(this.value)"
           id="grnNumberInput"/>
     <div id="grnNumberSuggestions" class="dropdown-menu w-100"></div>
</div>


<!-- Batch with Suggestions -->
<div class="col-md-2 position-relative">
    <label class="form-label">Batch</label>
    <input type="text" 
           class="form-control" 
           name="batch" 
           placeholder="Batch..." 
           value="{{ request.GET.batch }}"
           autocomplete="off"
           oninput="showBatchSuggestions(this.value)"
           id="batchInput"/>
    <div id="batchSuggestions" class="dropdown-menu w-100"></div>
</div>

<!-- Vendor -->
<div class="col-md-2">
<label class="form-label">Vendor</label>
<select class="form-select" name="vendor">
<option value="">All Vendors</option>
{% for vendor in suppliers %}
<option value="{{ vendor.vendor_code }}" {% if request.GET.vendor == vendor.vendor_code %}selected{% endif %}>
    {{ vendor.vendor_name }}
</option>
{% endfor %}
</select>
</div>

<!-- From Date -->
<div class="col-md-2">
<label class="form-label">From Date</label>
<input type="date" name="from_date" class="form-control" value="{{ request.GET.from_date }}">
</div>

<!-- To Date -->
<div class="col-md-2">
<label class="form-label">To Date</label>
<input type="date" name="to_date" class="form-control" value="{{ request.GET.to_date }}">
</div>

<!-- Search Buttons -->
<div class="col-md-6">
<button type="submit" class="btn btn-primary">Search</button>
<a href="{% url 'ajserp:materialinward' %}" class="btn btn-secondary">Clear</a>
</div>
</form>
</div>
</div>

<!-- =================================items table start======================== -->

<div class="row">
<div class="col-md-12">
<div class="card">

<div class="card-body">
<div class="d-flex gap-2">
<div class="d-flex justify-content-between" style="width:95%">
<!-- Left Search Box -->
<form method="GET" class="input-group" style="width: 300px">
<input type="text" name="q" class="form-control" placeholder="Search here..." value="{{ request.GET.q }}"/>
<button class="btn btn-primary" type="submit">Search</button>
</form>

<!-- Right Export Button -->
<div class="dropdown">
<button class="btn btn-primary btn-round dropdown-toggle" data-bs-toggle="dropdown" style="color:white; width: 91px; height: 36px;">
Export
</button>
<ul class="dropdown-menu import_1">
<li><a class="dropdown-item" href="#">Excel</a></li>
<li><a class="dropdown-item" href="#">PDF</a></li>
</ul>
</div>
</div>
</div>
</div>



<div class="table-responsive">
<table id="basic-datatables" class="display table table-bordered table-sm table-striped  align-middle table-hover text-center" style="border: 1px solid #d2caca;">
<thead style="padding: 13px 9px !important;">
<tr>
<th ><input type="checkbox" id="selectAll"></th>
<th>GRN&nbsp;Number</th>
<th>GRN&nbsp;Date</th>
<th>Batch</th>
<th>Material&nbsp;Code</th>
<th>Material&nbsp;Name</th>
<th>UOM</th>
<th>Category</th>
<th>Modal</th>
<th>Brand</th>
<th>HSN&nbsp;Code</th>
<th>Quantity</th>
<th>Action</th>
</tr>
</thead>

<tbody>
{% for inward in material_inwards %}
<tr>
<td style="padding: 0px !important;"><input type="checkbox" class="rowCheckbox"></td>
<td><a href="#" data-bs-toggle="modal" data-bs-target="#viewModal{{ inward.id }}">
    {{ inward.grn_number }}
  </a></td>
 <td>{{ inward.grn_date|date:"d-m-Y" }}</td>
<td>{{ inward.batch|default:"-" }}</td>
<td>{{ inward.material_code }}</td>
<td>{{ inward.material_name }}</td>
<td>{{ inward.uom }}</td>
<td>{{ inward.category }}</td>
<td>{{ inward.model.name|default:"-" }}</td>
<td>{{ inward.brand.name|default:"-" }}</td>
<td>{{ inward.hsn_code|default:"-" }}</td>
<td>{{ inward.quantity }}</td>    
<td>
<div class="form-button-action">
<!-- Edit Button -->
<button type="button" 
data-bs-toggle="modal" 
data-bs-target="#editModal{{ inward.id }}"
class="btn btn-link btn-primary btn-lg"
title="Edit Material Inward">
<i class="fa fa-edit"></i>
</button>

<!-- Delete Button -->
<button type="button"
data-bs-toggle="modal"
data-bs-target="#deleteModal{{ inward.id }}"
class="btn btn-link btn-danger"
title="Delete Material Inward">
<i class="fa fa-times"></i>
</button>
</div>
</td>
</tr>
{% empty %}
<tr>
<td colspan="12" class="text-center">No material inward records found.</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
<nav aria-label="Page navigation example">
<ul class="pagination justify-content-end">
<li class="page-item disabled">
<a class="page-link">Previous</a>
</li>
<li class="page-item">
<a class="page-link" href="#">1</a>
</li>
<li class="page-item active">
<a class="page-link" href="#">2</a>
</li>
<li class="page-item">
<a class="page-link" href="#">3</a>
</li>
<li class="page-item">
<a class="page-link" href="#">Next</a>
</li>
</ul>
</nav>
<!-- delete The Modal -->
<div class="modal fade" id="myModaldelete">
<div class="modal-dialog">
<div class="modal-content">
<!-- Modal Header -->
<div class="modal-header">
<h4 class="modal-title"></h4>
<button
type="button"
class="btn-close"
data-bs-dismiss="modal"
></button>
</div>

<!-- Modal body -->
<div class="modal-body">
<div
class="container"
style="text-align: center"
>
<h2>Delete Confirmation</h2>
<br />
<p>
Are you sure you want to delete this
Material Inward account?
</p>
</div>
</div>


<!-- Modal footer -->
<div
class="modal-footer"
style="display: inline; text-align: center"
>
<button
type="button"
class="btn btn-success"
data-bs-dismiss="modal"
>
Yes
</button>
<button
type="button"
class="btn btn-danger"
data-bs-dismiss="modal"
>
No
</button>
</div>
</div>
</div>
</div>


{% comment %} <!-- view The Modal -->

<div class="modal fade" id="myModalinward">
<div class="modal-dialog modal-lg">
<div class="modal-content">

<!-- Modal Header -->
<div class="modal-header">
<h4 class="modal-title">Material Inward</h4>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="">
<!--view  content start-->
<div class="row">
<div class="col-md-12">
<div class="">

<div class="card-body">
<div class="row">
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">GRN Number</label>
<input type="text" class="form-control" id="text"  />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">GRN Date</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">Batch</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">Material Code</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">Material Name</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">UOM</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="exampleFormControlSelect1">Category</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="exampleFormControlSelect1">Model</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="exampleFormControlSelect1">Brand</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">HSN Code</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">Vendor Code</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">Vendor Name</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">Invoice Number</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="date">Invoice Date</label>
<input type="date" class="form-control" id="date" />
</div>
</div>
<div class="col-md-4 col-lg-4">
<div class="form-group">
<label for="text">Quantity</label>
<input type="text" class="form-control" id="text" />
</div>
</div>
</div>

<!-- ==================2============= -->

<!-- Modal footer -->
<div class="modal-footer text-end">
<button
type="button"
class="btn btn-danger"
data-bs-dismiss="modal"
>
Close
</button>
</div> {% endcomment %}
</div>
</div>
</div>
</div>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>





<!-- ======================table end main content======================== -->

<!-- ====================footer start========================= -->

{% include "./includes/footer.html" %}
</div>
<!-- custom template setting -->
{% include "./includes/template_setting.html" %}
</div>
</div>

<!-- ==================== EDIT/DELETE MODALS ==================== -->
<!-- ==================== EDIT/DELETE MODALS ==================== -->
{% for inward in material_inwards %}
    {% if inward.id %}  <!-- Add this check to ensure inward has an ID -->
    <!-- Edit Modal for {{ inward.id }} -->
<!-- ===================== VIEW MODAL ===================== -->
<div class="modal fade" id="viewModal{{ inward.id }}">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">

            <div class="modal-header bg-light">
                <h4 class="modal-title fw-bold">
                    Material Inward â€” {{ inward.grn_number }}
                </h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <div class="row g-3">

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">GRN Number</label>
                        <input type="text" class="form-control" value="{{ inward.grn_number }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">GRN Date</label>
                        <input type="text" class="form-control" value="{{ inward.grn_date|date:'d-m-Y' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Batch</label>
                        <input type="text" class="form-control" value="{{ inward.batch|default:'-' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Material Code</label>
                        <input type="text" class="form-control" value="{{ inward.material_code }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Material Name</label>
                        <input type="text" class="form-control" value="{{ inward.material_name }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">UOM</label>
                        <input type="text" class="form-control" value="{{ inward.uom }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Category</label>
                        <input type="text" class="form-control" value="{{ inward.category }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Model</label>
                        <input type="text" class="form-control" value="{{ inward.model.name|default:'-' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Brand</label>
                        <input type="text" class="form-control" value="{{ inward.brand.name|default:'-' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">HSN Code</label>
                        <input type="text" class="form-control" value="{{ inward.hsn_code|default:'-' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Vendor Code</label>
                        <input type="text" class="form-control" value="{{ inward.vendor.vendor_code }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Vendor Name</label>
                        <input type="text" class="form-control" value="{{ inward.vendor.vendor_name }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Invoice Number</label>
                        <input type="text" class="form-control" value="{{ inward.invoice_number }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Invoice Date</label>
                        <input type="text" class="form-control" value="{{ inward.invoice_date|date:'d-m-Y' }}" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Quantity</label>
                        <input type="text" class="form-control" value="{{ inward.quantity }}" readonly>
                    </div>

                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>


   <div class="modal fade" id="editModal{{ inward.id }}">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Edit Material Inward</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- EDIT FORM -->
            <form method="POST" action="{% url 'ajserp:edit_materialinward' inward_id=inward.id %}">
                {% csrf_token %}

                <div class="modal-body">
                    <div class="row g-3">

                        <!-- CATEGORY -->
                        <div class="col-md-4">
                            <label class="form-label">Category *</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select Category</option>
                                <option value="Service" {% if inward.category == "Service" %}selected{% endif %}>
                                    Service
                                </option>
                                <option value="Spare" {% if inward.category == "Spare" %}selected{% endif %}>
                                    Spare
                                </option>
                                <option value="Material" {% if inward.category == "Material" %}selected{% endif %}>
                                    Material
                                </option>
                            </select>
                        </div>

                        <!-- GRN NUMBER (READONLY) -->
                        <div class="col-md-4">
                            <label class="form-label">GRN Number</label>
                            <input type="text" class="form-control" value="{{ inward.grn_number }}" readonly>
                        </div>

                        <!-- GRN DATE -->
                        <div class="col-md-4">
                            <label class="form-label">GRN Date *</label>
                            <input type="date" class="form-control" name="grn_date"
                                   value="{{ inward.grn_date|date:'Y-m-d' }}" required>
                        </div>

                        <!-- MATERIAL CODE (READONLY) -->
                        <div class="col-md-4">
                            <label class="form-label">Material Code</label>
                            <input type="text" class="form-control" value="{{ inward.material_code }}" readonly>
                        </div>

                        <!-- MATERIAL NAME (READONLY) -->
                        <div class="col-md-4">
                            <label class="form-label">Material Name</label>
                            <input type="text" class="form-control" value="{{ inward.material_name }}" readonly>
                        </div>

                        <!-- UOM (READONLY) -->
                        <div class="col-md-4">
                            <label class="form-label">UOM</label>
                            <input type="text" class="form-control" value="{{ inward.uom }}" readonly>
                        </div>

                        <!-- VENDOR -->
                        <div class="col-md-4">
                            <label class="form-label">Vendor *</label>
                            <select class="form-select" name="vendor" required>
                                <option value="">Select Vendor</option>
                                {% for vendor in vendors %}
                                    <option value="{{ vendor.vendor_code }}"
                                        {% if inward.vendor.vendor_code == vendor.vendor_code %}selected{% endif %}>
                                        {{ vendor.vendor_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- INVOICE NUMBER -->
                        <div class="col-md-4">
                            <label class="form-label">Invoice Number *</label>
                            <input type="text" class="form-control" name="invoice_number"
                                   value="{{ inward.invoice_number }}" required>
                        </div>

                        <!-- INVOICE DATE -->
                        <div class="col-md-4">
                            <label class="form-label">Invoice Date *</label>
                            <input type="date" class="form-control" name="invoice_date"
                                   value="{{ inward.invoice_date|date:'Y-m-d' }}" required>
                        </div>

                        <!-- QUANTITY -->
                        <div class="col-md-4">
                            <label class="form-label">Quantity *</label>
                            <input type="number" class="form-control" name="quantity"
                                   value="{{ inward.quantity }}" min="0" step="0.01" required>
                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Close
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Save Changes
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>

    <!-- Delete Modal for {{ inward.id }} -->
    <div class="modal fade" id="deleteModal{{ inward.id }}">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Delete Confirmation</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <!-- CORRECTED: Using keyword argument -->
                <form method="POST" action="{% url 'ajserp:delete_materialinward' inward_id=inward.id %}">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="container" style="text-align: center">
                            <p>Are you sure you want to delete <strong>{{ inward.grn_number }}</strong>?</p>
                            
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-danger">Yes, Delete</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}
{% endfor %}
{% endblock %}