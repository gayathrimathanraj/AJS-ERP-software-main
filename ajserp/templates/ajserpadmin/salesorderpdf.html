<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <meta charset="utf-8">
    <style>
        @page {
            size: A4;
            margin: 0.3cm;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 9px;
            line-height: 1.1;
            margin: 0;
            padding: 8px;
            color: #000;
        }

        table { width: 100%; border-collapse: collapse; }
        .tiny { font-size: 7px; color: #666; }
    </style>
</head>
<body>

<!-- HEADER WITH LOGO + COMPANY INFO -->
<table style="width:100%; border:1px solid #ccc; padding:6px; margin-bottom:8px; font-size:9px;">
    <tr>

        <!-- LOGO -->
        <td style="width:20%; text-align:center; vertical-align:middle;">
            <img src="{% static 'logo/logo.png' %}" style="width:70px; height:auto;">
        </td>

        <!-- COMPANY INFO -->
        <td style="width:80%; text-align:center; vertical-align:middle;">
            <div style="font-size:25px; font-weight:bold; color:#003366;">AJ SOLAR</div>
            <div style="font-size:20px; font-weight:bold; margin-bottom:3px;">LITTLE RAY</div>

            <div style="font-size:9px; line-height:1.3;">
                KBM Complex, Poovalur Road, Shanthi Nagar,<br>
                Sakthi Hospital (Opp), Lalgudi, Trichy â€“ 621601.
            </div>

            <div style="font-size:9px; line-height:1.2;">
                <b>Mobile:</b> 9790403047 / 8525035361 &nbsp;&nbsp;&nbsp;
                <b>Email:</b> ajsolar@gmail.com &nbsp;&nbsp;&nbsp;
                <b>GSTIN:</b> 33CEDPB5711A12G
            </div>
        </td>

    </tr>
</table>

<!-- SALES ORDER TITLE -->
<div style="text-align:center; font-size:14px; font-weight:bold; margin:4px 0; padding:4px 0; background:#64B5F6">
    SALES ORDER
</div>

<!-- CUSTOMER + DELIVERY + DETAILS -->
<table style="width:100%; border:1px solid #ccc; padding:5px; margin-bottom:10px; font-size:9px;">
    <tr>

        <!-- CUSTOMER -->
        <td style="width:33%; vertical-align:top; padding:4px; border-right:1px solid #ccc;">
            <strong>Customer Details:</strong><br>
            {{ sales_order.customer.customer_name }}<br>
            {{ sales_order.customer.address1 }}<br>
            {{ sales_order.customer.city }}, {{ sales_order.customer.state }}<br>
            Mobile: {{ sales_order.customer.contact_number }}<br>
            GSTIN: {{ sales_order.customer.gst_number }}
        </td>

        <!-- DELIVERY ADDRESS -->
        <td style="width:33%; vertical-align:top; padding:4px; border-right:1px solid #ccc;">
            <strong>Deliver To:</strong><br>
            {{ shipping_address.address1 }}<br>
            {{ shipping_address.city }}, {{ shipping_address.state }}<br>
            {{ shipping_address.pincode }}
        </td>

        <!-- ORDER DETAILS -->
        <td style="width:34%; vertical-align:top; padding:4px;">
            <strong>Details:</strong><br>

            <b>SO No:</b> {{ sales_order.so_number }}<br>
            <b>Date:</b> {{ sales_order.date|date:"d/m/Y" }}<br>

            <b>Reference:</b> {{ sales_order.reference|default:"-" }}<br>

            <b>Payment Terms:</b>
            {% if sales_order.payment_terms %}
                {{ sales_order.payment_terms }}
            {% else %}
                Immediate Payment
            {% endif %}
            <br>

            <b>Delivery Date:</b> {{ sales_order.delivery_date|date:"d/m/Y" }}<br>
        </td>
    </tr>
</table>

<!-- ITEMS TABLE -->
<table style="width:100%; margin-bottom:5px; font-size:8px; border:1px solid #ccc;">
    <thead>
        <tr style="background:#fff;">
            <th style="width:40%; border:1px solid #ccc; padding:6px;">Material</th>
            <th style="width:8%; border:1px solid #ccc; padding:6px;">HSN</th>
            <th style="width:8%; border:1px solid #ccc; padding:6px;">QTY</th>
            <th style="width:10%; border:1px solid #ccc; padding:6px;">RATE</th>
            <th style="width:8%; border:1px solid #ccc; padding:6px;">DISC</th>
            <th style="width:12%; border:1px solid #ccc; padding:6px;">BASIC</th>
            <th style="width:7%; border:1px solid #ccc; padding:6px;">TAX</th>
            <th style="width:7%; border:1px solid #ccc; padding:6px;">AMOUNT</th>
        </tr>
    </thead>

    <tbody>
        {% for item in items %}
        <tr>
            <td style="padding:6px; border:1px solid #eee;">
                {{ item.material_name }}
                {% if item.description %}
                <div class="tiny">{{ item.description }}</div>
                {% endif %}
            </td>

            <td style="text-align:center; padding:6px; border:1px solid #eee;">{{ item.hsn_code }}</td>
            <td style="text-align:center; padding:6px; border:1px solid #eee;">{{ item.quantity|floatformat:0 }}</td>
            <td style="text-align:right; padding:6px; border:1px solid #eee;">{{ item.rate|floatformat:0 }}</td>
            <td style="text-align:right; padding:6px; border:1px solid #eee;">{{ item.discount|floatformat:0 }}</td>
            <td style="text-align:right; padding:6px; border:1px solid #eee;">{{ item.taxable_amount|floatformat:2 }}</td>
            <td style="text-align:right; padding:6px; border:1px solid #eee;">{{ item.tax_amount|floatformat:2 }}</td>
            <td style="text-align:right; padding:6px; border:1px solid #eee;">{{ item.amount|floatformat:2 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- TOTAL ROW -->
<table style="width:100%; border:1px solid #ccc; margin-top:5px; font-size:8px;">
    <tr>
        <td style="width:40%; padding:6px; font-weight:bold;">TOTAL</td>
        <td style="width:8%;"></td>
        <td style="width:8%; text-align:center;">{{ total_qty|floatformat:0 }}</td>
        <td style="width:10%;"></td>
        <td style="width:8%;"></td>
        <td style="width:12%; text-align:right;">{{ total_taxable_amount|floatformat:2 }}</td>
        <td style="width:7%; text-align:right;">{{ total_tax_amount|floatformat:2 }}</td>
        <td style="width:7%; text-align:right;">{{ grand_total|floatformat:2 }}</td>
    </tr>
</table>

<!-- GST SUMMARY -->
<td style="width:40%; vertical-align:top; padding-left:10px;">

    <table style="width:100%; font-size:8px; border-collapse:collapse; text-align:right;">

        <!-- TAXABLE AMOUNT -->
        <tr>
            <td style="padding:2px 0; text-align:right;">
                Taxable Amount&nbsp;&nbsp; Rs. {{ total_taxable_amount|floatformat:2 }}
            </td>
        </tr>

        {% for key, data in gst_summary.items %}

            {% if data.cgst %}
            <tr>
                <td style="padding:2px 0; text-align:right;">
                    CGST @{{ key.0|floatformat:0 }}% &nbsp;&nbsp; Rs. {{ data.cgst|floatformat:2 }}
                </td>
            </tr>
            {% endif %}

            {% if data.sgst %}
            <tr>
                <td style="padding:2px 0; text-align:right;">
                    SGST @{{ key.1|floatformat:0 }}% &nbsp;&nbsp; Rs. {{ data.sgst|floatformat:2 }}
                </td>
            </tr>
            {% endif %}

            {% comment %} {% if data.igst %}
            <tr>
                <td style="padding:2px 0; text-align:right;">
                    IGST @{{ key.2|floatformat:0 }}% &nbsp;&nbsp; Rs. {{ data.igst|floatformat:2 }}
                </td>
            </tr>
            {% endif %}

            {% if data.cess %}
            <tr>
                <td style="padding:2px 0; text-align:right;">
                    CESS @{{ key.3|floatformat:0 }}% &nbsp;&nbsp; Rs. {{ data.cess|floatformat:2 }}
                </td>
            </tr>
            {% endif %} {% endcomment %}

        {% endfor %}

        <!-- SEPARATOR LINE -->
        <tr>
            <td style="border-top:1px solid #000; padding:4px 0;"></td>
        </tr>

        <!-- TOTAL + WORDS -->
        <tr>
            <td style="padding:4px 0; text-align:right;">
                <b>Total Amount&nbsp;&nbsp; Rs. {{ grand_total|floatformat:0 }}</b><br>
                <span style="font-size:7px;">Total Amount (in Words): {{ amount_in_words }}</span>
            </td>
        </tr>

        <!-- BOTTOM BORDER -->
        <tr>
            <td style="border-bottom:1px solid #000; padding:0;"></td>
        </tr>

    </table>

</td>


<!-- BANK + TERMS + SIGN -->
<table style="width:100%; margin-top:10px;">
    <tr>

        <!-- BANK DETAILS -->
        <td style="width:70%; padding:6px; vertical-align:top;">
            <strong>Bank Details:</strong><br>
            Name: SB SOLAR SHOP<br>
            IFSC: IOBA0001092<br>
            Account No: 109202000001814<br>
            Bank: Indian Overseas Bank, EDAMELAIYUR<br><br>

            <strong>TERMS AND CONDITIONS</strong><br>
            * Goods once sold cannot be returned.<br>
            * GST Included.<br>
            * Warranty as per manufacturer policy.<br>
        </td>

        <!-- SIGN -->
        <td style="width:30%; text-align:center; vertical-align:bottom;">
            <strong>Authorised Signatory</strong><br>
            <div style="margin-top:40px;">
                {{ sales_order.sales_person|default:"AJ SOLAR" }}
            </div>
        </td>

    </tr>
</table>

<hr style="border:0; border-top:1px solid #000; height:1px;">
</body>
</html>
