{% extends './base.html' %}
{% load static %}

{% block content %}
<div class="wrapper">

{% include "./includes/sidebar.html" %}

<div class="main-panel">
<div class="main-header">
<div class="main-header-logo">
{% include "./includes/navbar.html" %}
</div>

<div class="container">
<div class="page-inner">

<div class="page-header">
<h3 class="fw-bold mb-3">Set Permissions</h3>
<ul class="breadcrumbs mb-3">
<li class="nav-home"><a href="#"><i class="icon-home"></i></a></li>
<li class="separator"><i class="icon-arrow-right"></i></li>
<li class="nav-item"><a href="#">Manage Users</a></li>
<li class="separator"><i class="icon-arrow-right"></i></li>
<li class="nav-item"><a href="#">Permissions</a></li>
</ul>
</div>

<div class="card">
<div class="card-header">
<h4 class="card-title">Permissions for: {{ user_obj.username }}</h4>
</div>

<div class="card-body">

<form method="POST">
{% csrf_token %}

{% for module in modules %}
<div class="card border mb-4">

<!-- MODULE -->
<div class="card-header bg-light">
<div class="form-check">
<input type="checkbox"
class="form-check-input module-checkbox"
id="module_{{ module.key }}"
data-module="{{ module.key }}">
<label for="module_{{ module.key }}" class="fw-bold">
{{ module.label }}
</label>
</div>
</div>

<!-- SUBMENUS -->
<div class="card-body">

<div class="table-responsive">
<table class="table table-sm align-middle">
<thead>
<tr>
<th>Menu / Page</th>
<th class="text-center">View</th>
<th class="text-center">Edit</th>
<th class="text-center">Delete</th>
</tr>
</thead>
<tbody>

{% for submenu in module.submenus %}
{% with base_key=module.key|add:"__"|add:submenu.key %}
{% with view_key=base_key|add:"__view" edit_key=base_key|add:"__edit" delete_key=base_key|add:"__delete" %}

<tr>
<td>{{ submenu.label }}</td>

<td class="text-center">
<input type="checkbox"
class="form-check-input submenu-checkbox"
data-module="{{ module.key }}"
name="{{ view_key }}"
{% if view_key in existing_permissions %}checked{% endif %}>

</td>
<td class="text-center">
<input type="checkbox"
       class="form-check-input submenu-checkbox"
       data-module="{{ module.key }}"
       name="{{ edit_key }}"
       {% if edit_key in existing_permissions %}checked{% endif %}>



</td>

<td class="text-center">
<input type="checkbox"
       class="form-check-input submenu-checkbox"
       data-module="{{ module.key }}"
       name="{{ delete_key }}"
       {% if delete_key in existing_permissions %}checked{% endif %}>

</td>
</tr>

{% endwith %}
{% endwith %}
{% endfor %}

</tbody>
</table>
</div>

</div>
</div>
{% endfor %}

<button class="btn btn-primary mt-3">Save Permissions</button>
<a href="{% url 'ajserp:manage_users' %}" class="btn btn-secondary mt-3 ms-2">Back</a>

</form>

</div>
</div>

</div>
</div>

</div>
</div>

</div>
{% endblock %}
