{% extends './base.html' %}
{% load static %}
{% block content %}

<div class="wrapper">
{% include "./includes/sidebar.html" %}

<div class="main-panel">
<div class="main-header" style="background: content-box !important">
<div class="main-header-logo">
{% include "./includes/navbar.html" %}
</div>

<!-- ================= PAGE HEADER ================= -->

<div class="container">
<div class="row">
<h3 class="fw-bold ms-3 ps-3 pt-3">Payment</h3>

<div class="page-header mt-1">
<div class="col-md-9">
<ul class="breadcrumbs mb-3">
<li class="nav-home">
<a href="{% url 'ajserp:dashboard' %}">
<i class="icon-home"></i>
</a>
</li>
<li class="separator"><i class="icon-arrow-right"></i></li>
<li class="nav-item"><a href="#">Finance</a></li>
<li class="separator"><i class="icon-arrow-right"></i></li>
<li class="nav-item"><a href="#">Payment</a></li>
</ul>
</div>

<div class="col-md-3 text-end">
<a href="{% url 'ajserp:addpaymentsout' %}"
   class="btn btn-primary btn-round"
   style="width:91px;height:36px;padding-top:6px;">
Add
</a>
</div>
</div>
</div>


<!-- ================= FILTER / SEARCH CARD ================= -->

<div class="container-fluid">
<div class="card">
<div class="card-body">

<form method="GET">
<div class="row g-3 align-items-end">

<div class="col-md-2">
<input type="text"
       name="payment_id"
       class="form-control"
       placeholder="Payment ID..."
       value="{{ request.GET.payment_id }}">
</div>

<div class="col-md-3">
<input type="text"
       name="vendor_name"
       class="form-control"
       placeholder="Vendor Name..."
       value="{{ request.GET.vendor_name }}">
</div>

<div class="col-md-2">
<select class="form-select" name="status">
<option value="">Select Status</option>
<option value="Active" {% if request.GET.status == "Active" %}selected{% endif %}>Active</option>
<option value="Draft" {% if request.GET.status == "Draft" %}selected{% endif %}>Draft</option>
</select>
</div>

<div class="col-md-2">
<button type="submit" class="btn btn-primary w-50">Search</button>
</div>

<div class="col-md-2">
{% if request.GET %}
<a href="{% url 'ajserp:paymentout' %}"
   class="btn btn-secondary w-50">Clear</a>
{% endif %}
</div>

</div>
</form>

</div>
</div>
</div>

<!-- ================= GLOBAL SEARCH ================= -->

<div class="container-fluid mt-3">
<div class="card">
<div class="card-body d-flex justify-content-between">

<div class="input-group" style="width:300px;">
<input type="text"
       id="globalSearchInput"
       class="form-control"
       placeholder="Search payment, vendor, mode..."
       value="{{ request.GET.q }}">
<button class="btn btn-primary" onclick="performGlobalSearch()">Search</button>
</div>

<p class="text-muted mb-0">
Total Payments:
<strong>{{ page_obj.paginator.count }}</strong>
</p>

</div>
</div>
</div>

<!-- ================= TABLE ================= -->

<div class="container-fluid mt-3">
<div class="card">
<div class="table-responsive">

<table class="table table-bordered table-sm table-striped align-middle table-hover text-center">
<thead>
<tr>
<th></th>
<th>Payment ID</th>
<th>Vendor</th>
<th>Mode</th>
<th>Amount</th>
<th>Action</th>
</tr>
</thead>

<tbody>
{% for payment in page_obj %}
<tr>

<td></td>

<td data-bs-toggle="modal" data-bs-target="#viewModal{{ payment.id }}">
<a href="#">{{ payment.payment_id }}</a>
</td>

<td>{{ payment.vendor.vendor_name }}</td>
<td>{{ payment.mode_of_payment }}</td>
<td>{{ payment.payment_amount }}</td>

<td>
<div class="form-button-action">

<button class="btn btn-link btn-primary btn-lg"
        data-bs-toggle="modal"
        data-bs-target="#editModal{{ payment.id }}">
<i class="fa fa-edit"></i>
</button>

<button class="btn btn-link btn-danger"
        data-bs-toggle="modal"
        data-bs-target="#deleteModal{{ payment.id }}">
<i class="fa fa-times"></i>
</button>

</div>
</td>

</tr>

<!-- ================= VIEW MODAL ================= -->

<div class="modal fade" id="viewModal{{ payment.id }}">
<div class="modal-dialog modal-xl">
<div class="modal-content">

<div class="modal-header bg-light">
<h4 class="modal-title fw-bold">
View Payment — {{ payment.payment_id }}
</h4>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">
<div class="row g-4">

<div class="col-md-4">
<label>Vendor</label>
<input class="form-control" value="{{ payment.vendor.vendor_name }}" readonly>
</div>

<div class="col-md-4">
<label>Date</label>
<input class="form-control" value="{{ payment.payment_date }}" readonly>
</div>

<div class="col-md-4">
<label>Mode</label>
<input class="form-control" value="{{ payment.mode_of_payment }}" readonly>
</div>

<div class="col-md-4">
<label>Amount</label>
<input class="form-control" value="{{ payment.payment_amount }}" readonly>
</div>

<div class="col-md-12">
<label>Remarks</label>
<textarea class="form-control" readonly>{{ payment.remarks }}</textarea>
</div>

</div>
</div>

<div class="modal-footer">
<button class="btn btn-danger" data-bs-dismiss="modal">Close</button>
</div>

</div>
</div>
</div>

<!-- ================= EDIT MODAL ================= -->

<div class="modal fade" id="editModal{{ payment.id }}">
<div class="modal-dialog modal-xl">
<div class="modal-content">

<div class="modal-header bg-light">
<h4 class="modal-title fw-bold">
Edit Payment — {{ payment.payment_id }}
</h4>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<form method="POST"
      action="{% url 'ajserp:payment_update' payment.id %}">
{% csrf_token %}

<div class="modal-body">
<div class="row g-4">

<div class="col-md-4">
<label>Mode of Payment</label>
<input name="mode_of_payment"
       class="form-control"
       value="{{ payment.mode_of_payment }}">
</div>

<div class="col-md-4">
<label>Payment Reference</label>
<input name="payment_reference"
       class="form-control"
       value="{{ payment.payment_reference }}">
</div>

<div class="col-md-12">
<label>Remarks</label>
<textarea name="remarks"
          class="form-control">{{ payment.remarks }}</textarea>
</div>

</div>
</div>

<div class="modal-footer">
<button class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
<button class="btn btn-success" type="submit">Save Changes</button>
</div>

</form>

</div>
</div>
</div>

<!-- ================= DELETE MODAL ================= -->

<div class="modal fade" id="deleteModal{{ payment.id }}">
<div class="modal-dialog">
<div class="modal-content">

<div class="modal-header">
<h4 class="modal-title">Delete Payment</h4>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<form method="POST"
      action="{% url 'ajserp:payment_remove' payment.id %}">
{% csrf_token %}

<div class="modal-body text-center">
<p>
Are you sure you want to delete
<strong>{{ payment.payment_id }}</strong>?
</p>
</div>

<div class="modal-footer">
<button class="btn btn-danger" type="submit">Yes, Delete</button>
<button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
</div>

</form>

</div>
</div>
</div>

{% empty %}
<tr>
<td colspan="6">No payments found</td>
</tr>
{% endfor %}
</tbody>

</table>
</div>
</div>
</div>

{% include "./includes/footer.html" %}
</div>

{% include "./includes/template_setting.html" %}
</div>
</div>

{% comment %} <script>
function performGlobalSearch() {
  const q = document.getElementById("globalSearchInput").value;
  const url = new URL(window.location.href);
  url.searchParams.set("q", q);
  window.location.href = url.toString();
}
</script> {% endcomment %}

{% endblock %}
